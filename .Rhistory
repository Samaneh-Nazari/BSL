devtools::install()
devtools::document()
q=5
n=100
true_dag = randomDAG(q, prob = 3/(2*q-2))
A = t(as(true_dag, "matrix"))
A[A != 0] = 1
L = A*matrix(runif(q*q, 1, 2), q, q)*sample(c(-1, 1), size = q*q, replace = TRUE); diag(L) = 1
D = diag(rep(1, q))
Sigma = solve(t(L))%*%D%*%solve(L)
mu    = c(rep(0, q))
# Generate the data
library(mvtnorm)
Y = rmvnorm(n, mu, Sigma)
m = colMeans(Y)
s = apply(X = Y, FUN = sd, MARGIN = 2)
Y = t(t(Y) - m)
plot(graph_from_adjacency_matrix(A))
pa(1,A)
fa(1,A)
?pa
?fa
devtools::install()
devtools::install()
devtools::document()
fa(1,A)
pa(1,A)
devtools::install()
devtools::install()
devtools::install()
devtools::document()
m_j(1,A,Y,n,n-1,2)
m_j(2,A,Y,n,n-1,2)
n
m_j(2,A,Y,100,100-1,2)
dim(Y)
m_j(2,A,Y,100,100-1,2)
m_j(2,A,Y,100,100-1,2)
m_j(3,A,Y,100,100-1,2)
m_j(4,A,Y,100,100-1,2)
m_j(5,A,Y,100,100-1,2)
devtools::install()
devtools::install()
devtools::document()
devtools::document()
devtools::document()
devtools::install()
devtools::install()
devtools::document()
remove.packages("BSL")
remove.packages("BSL")
library(igraph)
library(pcalg)
library(devtools)
library(roxygen2)
library(testthat)
library(knitr)
q=5
n=100
true_dag = randomDAG(q, prob = 3/(2*q-2))
A = t(as(true_dag, "matrix"))
A[A != 0] = 1
L = A*matrix(runif(q*q, 1, 2), q, q)*sample(c(-1, 1), size = q*q, replace = TRUE); diag(L) = 1
D = diag(rep(1, q))
Sigma = solve(t(L))%*%D%*%solve(L)
mu    = c(rep(0, q))
# Generate the data
library(mvtnorm)
Y = rmvnorm(n, mu, Sigma)
m = colMeans(Y)
s = apply(X = Y, FUN = sd, MARGIN = 2)
Y = t(t(Y) - m)
plot(graph_from_adjacency_matrix(A))
pa(2,A)
devtools::install()
pa(2,A)
devtools::document()
devtools::install()
pa(1,A)
pa(2,A)
fa(2,A)
m_j(2,A,Y,n,q,2)
m_j(3,A,Y,n,q,2)
m_j(4,A,Y,n,q,2)
m_j(5,A,Y,n,q,2)
devtools::install()
devtools::install()
devtools::document()
devtools::document()
devtools::document()
m_1(A,Y,n,q,2)
devtools::document()
devtools::install()
devtools::install()
m_1(A,Y,n,q,2)
remove.packages("BSL")
library(igraph)
library(pcalg)
library(devtools)
library(roxygen2)
library(testthat)
library(knitr)
q=5
n=100
true_dag = randomDAG(q, prob = 3/(2*q-2))
A = t(as(true_dag, "matrix"))
A[A != 0] = 1
L = A*matrix(runif(q*q, 1, 2), q, q)*sample(c(-1, 1), size = q*q, replace = TRUE); diag(L) = 1
D = diag(rep(1, q))
Sigma = solve(t(L))%*%D%*%solve(L)
mu    = c(rep(0, q))
# Generate the data
library(mvtnorm)
Y = rmvnorm(n, mu, Sigma)
m = colMeans(Y)
s = apply(X = Y, FUN = sd, MARGIN = 2)
Y = t(t(Y) - m)
plot(graph_from_adjacency_matrix(A))
devtools::install()
pa(3,A)
devtools::document()
devtools::install()
pa(3,A)
fa(3,A)
m_j(3,A,Y,n,a,2)
a
m_j(3,A,Y,n,n-1,2)
devtools::document()
devtools::install()
devtools::document()
devtools::document()
devtools::install()
devtools::install()
devtools::document()
devtools::install()
devtools::document()
devtools::install()
devtools::document()
library(roxygen2)
devtools::document()
devtools::document()
devtools::install()
dim(Y)
devtools::document()
devtools::install()
devtools::document()
devtools::install()
devtools::document()
library(devtools)
library(roxygen2)
library(testthat)
library(knitr)
library(igraph)
library(pcalg)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
m_1(A,Y,n,n-1,2)
A
q=5
n=100
true_dag = randomDAG(q, prob = 3/(2*q-2))
library(pcalg)
true_dag = randomDAG(q, prob = 3/(2*q-2))
A = t(as(true_dag, "matrix"))
A[A != 0] = 1
L = A*matrix(runif(q*q, 1, 2), q, q)*sample(c(-1, 1), size = q*q, replace = TRUE); diag(L) = 1
D = diag(rep(1, q))
Sigma = solve(t(L))%*%D%*%solve(L)
mu    = c(rep(0, q))
# Generate the data
library(mvtnorm)
Y = rmvnorm(n, mu, Sigma)
m = colMeans(Y)
s = apply(X = Y, FUN = sd, MARGIN = 2)
Y = t(t(Y) - m)
library(igraph)
plot(graph_from_adjacency_matrix(A))
m_1(A,Y,n,n-1,2)
?m_1
devtools::document()
m_1(A,Y,n,n-1,2)
devtools::document()
marg_like_j(1,A,Y,n-1,2,n)
devtools::install()
devtools::document()
devtools::install()
devtools::install()
devtools::document()
devtools::install()
marg_like_j(1,A,Y,n-1,2,n)
marg_like_j(2,A,Y,n-1,2,n)
marg_like_j(3,A,Y,n-1,2,n)
marg_like_j(4,A,Y,n-1,2,n)
marg_like_j(5,A,Y,n-1,2,n)
devtools::install()
devtools::install()
devtools::install()
devtools::document()
devtools::document()
BSL:::n.edge(A)
library(igraph)
library(pcalg)
library(devtools)
library(roxygen2)
library(testthat)
library(knitr)
q=5
n=100
true_dag = randomDAG(q, prob = 3/(2*q-2))
A = t(as(true_dag, "matrix"))
A[A != 0] = 1
L = A*matrix(runif(q*q, 1, 2), q, q)*sample(c(-1, 1), size = q*q, replace = TRUE); diag(L) = 1
D = diag(rep(1, q))
Sigma = solve(t(L))%*%D%*%solve(L)
mu    = c(rep(0, q))
# Generate the data
library(mvtnorm)
Y = rmvnorm(n, mu, Sigma)
m = colMeans(Y)
s = apply(X = Y, FUN = sd, MARGIN = 2)
Y = t(t(Y) - m)
plot(graph_from_adjacency_matrix(A))
devtools::document()
pa(1,A)
fa(1,A)
m_j(2,A,Y,n,n-1,2)
m_j(3,A,Y,n,n-1,2)
m_j(4,A,Y,n,n-1,2)
m_j(5,A,Y,n,n-1,2)
m_j(1,A,Y,n,n-1,2)
m_1(A,X,n,n-1,2)
m_1(A,Y,n,n-1,2)
BSL::fa(2,A)
BSL::marg_like_j(1,A,Y,n-1,2,n)
BSL::marg_like_j(2,A,Y,n-1,2,n)
BSL::marg_like_j(3,A,Y,n-1,2,n)
BSL:::n.edge(A)
devtools::document()
devtools::install()
BSL::move(A,q)
devtools::document()
devtools::install()
BSL::move(A,q)
A
BSL::move(A,q)
devtools::document()
BSL::move(A,q)
devtools::document()
BSL::move(A,q)
devtools::document()
BSL::move(A,q)
devtools::document()
devtools::install()
devtools::document()
BSL::move(A,q)
devtools::document()
BSL::posterior_sigma(Y,A,2,n-1)
devtools::document()
devtools::install()
devtools::document()
devtools::install()
devtools::document()
BSL::posterior_sigma(Y,A,2,n-1)
devtools::document()
devtools::install()
BSL::posterior_sigma(Y,A,2,n-1)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
BSL::posterior_sigma(Y,A,2,n-1)
cov(Y,Y)
BSL::posterior_sigma(Y,A,2,n-1)
BSL::posterior_sigma(Y,A,2,n-1)
devtools::document()
BSL::posterior_sigma(Y,A,2,n-1)
BSL::pa(1, A)
j_parents = sapply(X = 1:q, FUN = BSL::pa, object = A)
devtools::document()
devtools::install()
j_parents = sapply(X = 1:q, FUN = BSL::pa, object = A)
j_parents = sapply(X = 1:q, FUN = BSL::pa, object = A)
j_parents = sapply(X = 1:q, FUN = BSL::pa, DAG = A)
j_parents
BSL::posterior_sigma(Y,A,2,n-1)
BSL::posterior_sigma(Y,A,2,n-1)
BSL::posterior_sigma(Y,A,2,n-1)
BSL::posterior_sigma(Y,A,2,n-1)
pa(1,A)
?pa
devtools::document()
?pa
devtools::install()
?pa
devtools::document()
devtools::install()
BSL::m_j(2,A,Y,n,n-1,2)
devtools::document()
devtools::install()
BSL::m_j(2,A,Y,n,n-1,2)
BSL::m_j(3,A,Y,n,n-1,2)
BSL::m_j(4,A,Y,n,n-1,2)
BSL::m_j(5,A,Y,n,n-1,2)
BSL::m_j(1,A,Y,n,n-1,2)
devtools::document()
devtools::install()
BSL::m_j(1,A,Y,n,n-1,2)
BSL::m_1(A,Y,n,n-1,2)
BSL::marg_like_j(1,A,Y,n-1,2,n)
BSL::m_j(5,A,Y,n,n-1,2)
BSL::marg_like_j(5,A,Y,n-1,2,n)
BSL::move(A,q)
library(igraph)
library(igraph)
plot(graph_from_adjacency_matrix(A))
A
BSL::posterior_sigma(Y,A,g,a)
devtools::document()
devtools::install()
devtools::install()
devtools::document()
devtools::document()
devtools::install()
devtools::document()
devtools::install()
BSL::causal_y(BSL::posterior_sigma(Y,A,2,n-1)$sigma_post,A,2,X,1)
devtools::document()
devtools::install()
devtools::document()
devtools::document()
devtools::document()
library(BSL)
library(BSL)
library(GEOquery)
# دانلود و پردازش داده‌های GSE7390
gse <- getGEO("GSE7390", GSEMatrix = TRUE)
# استخراج اطلاعات بالینی (فراداده)
# این اطلاعات به صورت یک لیست از داده‌های بالینی برای هر نمونه است
pheno_data <- pData(gse[[1]]) # [[1]] چون این مجموعه داده فقط یک پلتفرم دارد
# نمایش ستون‌های موجود در داده‌های بالینی برای اطمینان
print(colnames(pheno_data))
cat("در حال بررسی تمام ستون‌های characteristics برای پیدا کردن ستون با دو دسته:\n\n")
# یک حلقه برای بررسی تمام ستون‌ها
for (col_name in colnames(pheno_data)) {
# فقط ستون‌های characteristics را بررسی کن
if (grepl("^characteristics_ch1\\.", col_name)) {
# تعداد مقادیر یکتا در ستون را بشمار
unique_vals <- unique(pheno_data[[col_name]])
# اگر ستون دقیقاً دو مقدار یکتا داشت، آن را چاپ کن
if (length(unique_vals) == 2) {
cat("---- نام ستون:", col_name, "----\n")
# این دستور تعداد هر مقدار را می‌شمارد (مثلاً 62 و 136)
print(table(pheno_data[[col_name]], useNA = "ifany")) # اینجا از "ifany" صحیح استفاده می‌کنیم
cat("\n")
}
}
}
# استخراج لیست بیماران با متاستاز (e.dmfs: 1,   Event.Distant Metastasis-Free Survival)
metastatic_samples <- pheno_data$geo_accession[pheno_data$characteristics_ch1.18 == "e.dmfs: 1"]
# استخراج لیست بیماران بدون متاستاز (e.dmfs: 0)
non_metastatic_samples <- pheno_data$geo_accession[pheno_data$characteristics_ch1.18 == "e.dmfs: 0"]
# چاپ نتایج نهایی
cat("تعداد بیماران با متاستاز:", length(metastatic_samples), "\n")
print(head(metastatic_samples))
cat("\nتعداد بیماران بدون متاستاز:", length(non_metastatic_samples), "\n")
print(head(non_metastatic_samples))
# ایجاد ستون جدید با نام metastasis_status
# اگر شرط برقرار بود (متاستاز شده)، مقدار 1 و در غیر این صورت مقدار 0 قرار می‌گیرد
pheno_data$metastasis_status <- ifelse(pheno_data$characteristics_ch1.18 == "e.dmfs: 1", 1, 0)
table(pheno_data$metastasis_status)
head(pheno_data)
# استخراج ماتریس بیان ژن
# این ماتریس به صورت "ژن x نمونه" است
expression_matrix <- exprs(gse[[1]])
genes_of_interest <- c("219228_at", "212989_at","213103_at","205508_at","219691_at","210056_at","204972_at","202869_at","208795_s_at","208682_s_at","203726_s_at","213680_at","202859_x_at","205207_at","201601_x_at","204747_at","219209_at","205862_at","218943_s_at","204533_at","209083_at","202357_s_at","203757_s_at","209498_at","206192_at","1405_i_at","221959_at","202381_at")
# ایجاد یک کپی از داده‌های بالینی برای ساخت دیتافریم نهایی
final_data <- pheno_data
# اضافه کردن ستون‌های بیان ژن مورد نظر به دیتافریم نهایی
# حلقه برای هر ژن در لیست شما اجرا می‌شود
for (gene_probe in genes_of_interest) {
# مقدار بیان آن ژن را از ماتریس استخراج کرده و به عنوان ستون جدید اضافه می‌کند
final_data[[gene_probe]] <- expression_matrix[gene_probe, ]
}
# حالا فقط ستون‌هایی که نیاز دارید را انتخاب کنید
# لیست ستون‌ها: شناسه نمونه، وضعیت متاستاز، و تمام ژن‌های مورد نظر
columns_to_keep <- c("geo_accession", "metastasis_status", genes_of_interest)
final_output <- final_data[, columns_to_keep]
colnames(final_output)= c("geo_accession", "metastasis_status","ZNF331","TMEM23","STARD13","SCN1B","SAMD9","RND1","OAS2","OAS1","MCM7","MAGED2","LAMA3","KRT6B","IL8","IL6","IFITM1","IFIT3","IFIH1","GREB1","DDX58","CXCL10","CORO1A","CFB","CEACAM6","CEACAM1","CDSN","CCL5","C8ORF72","ADAM9")
X=final_output[,3:30]
y=final_output[,2]
X=scale(X)
a=n+q-27-2
dim(X)
n=nrow(X)
q=ncol(X)
dim(X)
a=n+q-27-2
g=2
a
TT=5000
burn=1000
BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)
probs = round(matrix(rowMeans(out$A_chain[,(burn + 1):TT]), 29, 29), 4)
probs = round(matrix(rowMeans(BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)$A_chain[,(burn + 1):TT]), 29, 29), 4)
probs
probs
colnames(probs)
colnames(probs)=rownames(probs)=colnames(X)
dim(X)
colnames(X)
dim(probs)
colnames(probs)=rownames(probs)=colnames(final_output)
final_output
colnames(final_output)= c("geo_accession", "metastasis_status","ZNF331","TMEM23","STARD13","SCN1B","SAMD9","RND1","OAS2","OAS1","MCM7","MAGED2","LAMA3","KRT6B","IL8","IL6","IFITM1","IFIT3","IFIH1","GREB1","DDX58","CXCL10","CORO1A","CFB","CEACAM6","CEACAM1","CDSN","CCL5","C8ORF72","ADAM9")
colnames(probs)=rownames(probs)=colnames(final_output)
dim(probs)
probs
colnames(probs)=rownames(probs)=final_output
colnames(final_output)= c("metastasis_status","ZNF331","TMEM23","STARD13","SCN1B","SAMD9","RND1","OAS2","OAS1","MCM7","MAGED2","LAMA3","KRT6B","IL8","IL6","IFITM1","IFIT3","IFIH1","GREB1","DDX58","CXCL10","CORO1A","CFB","CEACAM6","CEACAM1","CDSN","CCL5","C8ORF72","ADAM9")
colnames(probs)=rownames(probs)=colnames(final_output)
colnames(probs)=rownames(probs)=final_output
TT=120000
TT=12000
burn=20000
BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)
out=BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)
out
dim(X)
X
dim(X)
library(GEOquery)
# دانلود و پردازش داده‌های GSE7390
gse <- getGEO("GSE7390", GSEMatrix = TRUE)
# استخراج اطلاعات بالینی (فراداده)
# این اطلاعات به صورت یک لیست از داده‌های بالینی برای هر نمونه است
pheno_data <- pData(gse[[1]]) # [[1]] چون این مجموعه داده فقط یک پلتفرم دارد
# نمایش ستون‌های موجود در داده‌های بالینی برای اطمینان
print(colnames(pheno_data))
cat("در حال بررسی تمام ستون‌های characteristics برای پیدا کردن ستون با دو دسته:\n\n")
# یک حلقه برای بررسی تمام ستون‌ها
for (col_name in colnames(pheno_data)) {
# فقط ستون‌های characteristics را بررسی کن
if (grepl("^characteristics_ch1\\.", col_name)) {
# تعداد مقادیر یکتا در ستون را بشمار
unique_vals <- unique(pheno_data[[col_name]])
# اگر ستون دقیقاً دو مقدار یکتا داشت، آن را چاپ کن
if (length(unique_vals) == 2) {
cat("---- نام ستون:", col_name, "----\n")
# این دستور تعداد هر مقدار را می‌شمارد (مثلاً 62 و 136)
print(table(pheno_data[[col_name]], useNA = "ifany")) # اینجا از "ifany" صحیح استفاده می‌کنیم
cat("\n")
}
}
}
# استخراج لیست بیماران با متاستاز (e.dmfs: 1,   Event.Distant Metastasis-Free Survival)
metastatic_samples <- pheno_data$geo_accession[pheno_data$characteristics_ch1.18 == "e.dmfs: 1"]
# استخراج لیست بیماران بدون متاستاز (e.dmfs: 0)
non_metastatic_samples <- pheno_data$geo_accession[pheno_data$characteristics_ch1.18 == "e.dmfs: 0"]
# چاپ نتایج نهایی
cat("تعداد بیماران با متاستاز:", length(metastatic_samples), "\n")
print(head(metastatic_samples))
cat("\nتعداد بیماران بدون متاستاز:", length(non_metastatic_samples), "\n")
print(head(non_metastatic_samples))
# ایجاد ستون جدید با نام metastasis_status
# اگر شرط برقرار بود (متاستاز شده)، مقدار 1 و در غیر این صورت مقدار 0 قرار می‌گیرد
pheno_data$metastasis_status <- ifelse(pheno_data$characteristics_ch1.18 == "e.dmfs: 1", 1, 0)
table(pheno_data$metastasis_status)
head(pheno_data)
# استخراج ماتریس بیان ژن
# این ماتریس به صورت "ژن x نمونه" است
expression_matrix <- exprs(gse[[1]])
genes_of_interest <- c("219228_at", "212989_at","213103_at","205508_at","219691_at","210056_at","204972_at","202869_at","208795_s_at","208682_s_at","203726_s_at","213680_at","202859_x_at","205207_at","201601_x_at","204747_at","219209_at","205862_at","218943_s_at","204533_at","209083_at","202357_s_at","203757_s_at","209498_at","206192_at","1405_i_at","221959_at","202381_at")
# ایجاد یک کپی از داده‌های بالینی برای ساخت دیتافریم نهایی
final_data <- pheno_data
# اضافه کردن ستون‌های بیان ژن مورد نظر به دیتافریم نهایی
# حلقه برای هر ژن در لیست شما اجرا می‌شود
for (gene_probe in genes_of_interest) {
# مقدار بیان آن ژن را از ماتریس استخراج کرده و به عنوان ستون جدید اضافه می‌کند
final_data[[gene_probe]] <- expression_matrix[gene_probe, ]
}
# حالا فقط ستون‌هایی که نیاز دارید را انتخاب کنید
# لیست ستون‌ها: شناسه نمونه، وضعیت متاستاز، و تمام ژن‌های مورد نظر
columns_to_keep <- c("geo_accession", "metastasis_status", genes_of_interest)
final_output <- final_data[, columns_to_keep]
colnames(final_output)= c("geo_accession", "metastasis_status","ZNF331","TMEM23","STARD13","SCN1B","SAMD9","RND1","OAS2","OAS1","MCM7","MAGED2","LAMA3","KRT6B","IL8","IL6","IFITM1","IFIT3","IFIH1","GREB1","DDX58","CXCL10","CORO1A","CFB","CEACAM6","CEACAM1","CDSN","CCL5","C8ORF72","ADAM9")
X=final_output[,3:30]
y=final_output[,2]
X=scale(X)
dim(X)
y
out=BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)
out
out$Causal_hat
probs=matrix(rowMeans(out$A_chain[,(burn + 1):TT]), 29, 29)
out$A_chain
probs=matrix(rowMeans(out$A_chain[,(burn + 1):TT]), 29, 29)
burn
TT
TT=12000
burn=2000
out=BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)
out
probs=matrix(rowMeans(out$A_chain[,(burn + 1):TT]), 29, 29)
probs
colnames(probs)=rownames(probs)=c("metastasis_status","ZNF331","TMEM23","STARD13","SCN1B","SAMD9","RND1","OAS2","OAS1","MCM7","MAGED2","LAMA3","KRT6B","IL8","IL6","IFITM1","IFIT3","IFIH1","GREB1","DDX58","CXCL10","CORO1A","CFB","CEACAM6","CEACAM1","CDSN","CCL5","C8ORF72","ADAM9")
probs
TT=120000
burn=50000
out=BSL::mcmc_dag_probit(y = y, X = X, TT = TT, burn = burn, causal = TRUE)
